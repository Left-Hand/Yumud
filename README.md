# Yumud

# åŸºäºC++20çš„åµŒå…¥å¼å¼€å‘æ¡†æ¶

"ç”¨Cå†™åµŒå…¥å¼å¤ªè†ˆåº”äº† é¢å‘å¯¹è±¡å¤šå¥½"
ç¼–å†™ç€ç»“æ„ä½“ä»¥åŠè°ƒç”¨åˆå§‹åŒ–å‡½æ•°çš„æˆ‘å¦‚æ­¤æƒ³åœ¨ç›®ç¹äº†arduinoç¼ºä¹å¯¹åº•å±‚çš„ç²¾ç»†åŒ–æ§åˆ¶ä¸HALå°šæœªæ‘†è„±çœŸæ­£çš„ç¡¬ä»¶æŠ½è±¡çš„æˆ‘è¿”å›äº†æ ‡å‡†åº“ã€‚ä½†è½¬å¿µä¸€æƒ³åˆ©ç”¨CPPçš„é«˜çº§è¯­æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è®©åµŒå…¥å¼ä»è¿™äº›ä»¤äººä½œå‘•çš„å¤–è®¾é…ç½®å˜æˆäº†è°ƒåº¦æŠ½è±¡è¯­ä¹‰çš„æ¸¸æˆï¼Œæ‰èƒ½å¤Ÿä½¿æˆ‘ä»¬ç¼–å†™å‡ºæ›´å¿«æ›´æ¸…çˆ½æ›´åŠ ä¸ç°ä»£è®¾è®¡æ¨¡å¼æ¥è½¨çš„ä»£ç ,ä¸æ˜¯å—ï¼Ÿ


æ— éœ€å¤æ‚çš„ç»“æ„ä½“é…ç½®ç‚¹äº®ä¸€ç›led

```c++

int main(){
    //...prework()
    auto & bled = portC[13];
    bled.outpp();
    while(true){
        bled = !bled;//blink XD
        delay(200);
    }
}

```

åˆæˆ–æ˜¯å¼€å¯äº’è¡¥PWMå¿«é€ŸéªŒè¯ä¸€ä¸ªBUCK

```C++
int main(){
    //...prework()

    // config timer at 36Khz
    timer1.init(36000);

    // get pwm for timer channel 1
    auto & pwm = timer1.oc(1);
    pwm.init();

    // set clamp to avoid overflow
    pwm.setClamp({0.1, 0.95});

    //to enable complementary for example
    auto & pwmn = timer1.ocn(1);//
    pwmn.init();

    // or just
    timer1.ocn(1).init();

    //init bdtr of timer1 with 200ns-deadzone by default
    timer1.initBdtr();

    //we can do this
    while(true){
        // t(time) is automatically changed by systick

        // we use overload so pwm can be assigned to a real_t
        pwm = 0.5 + 0.5 * sin(t);
    }

    //or...

    // use 0:0 pre:sub interrupt priority
    timer1.enableIt(TimerIT::Update, {0,0});

    //bind callback function
    timer1.bindCb(TimerIT::Update, [&](){pwm = 0.5 + 0.5 * sin(t);});
}

```

å†æˆ–è€…é€šè¿‡CANæŒ‡ä»¤ç²¾ç»†æ§åˆ¶äº‘å°çš„è§’åº¦

```C++

int main(){
    //...prework()

    can1.init(1000000);
    uart1.init(921600, CommMethod::DMA);
    UartHw & logger = uart1;

    Servo   servo   {timer1.ch(1)};
    Stepper stepper {timer1.ch(2);}
    Gimbal  gimbal  {servo, stepper};
    // automatically init all the things
    gimbal.init();

    while(true){
        static real_t angle;
        if(can1.available()){
            //read msg from can fifo
            auto & msg = can1.read();
            
            //using template to load message for remote
            msg.load(angle);

            //just print the angle
            logger.println("angle is:", angle);
        }

        gimbal.move_to(Vector2(1, 0).rotated(angle));
    }
}

```

å½“æˆ‘ä»¬ç”¨å¯¹è±¡æ„å»ºèµ·ä»£ç æ—¶ ä¸€åˆ‡æ˜¯å¦‚æ­¤è‡ªç„¶ä¸”æ¸…æ™°
æˆ‘ä»¬è„±ç¦»äº†å‚å®¶çš„SDKè¿™å¥—æ¡†æ¶å¯ä»¥è¢«æ‹“å±•è‡³å„ç±»å¤„ç†å™¨ä¸­


## âš ï¸å£°æ˜

ç›®å‰æ”¯æŒçš„èŠ¯ç‰‡åªæœ‰ch32(æ€§ä»·æ¯”ä¹‹ä¸çš®å®ç‹yyds)

å‚è€ƒäº†HALå’Œarduino ä½†ä½¿ç”¨äº†æŠ½è±¡å¼€é”€æˆæœ¬æ›´å°ä¸æ›´å®‰å…¨çš„æ–¹å¼ç¼–å†™

ä½¿ç”¨cpp20ç¼–å†™ è¯·ä½¿ç”¨gcc12+è¿›è¡Œç¼–è¯‘
ä½¿ç”¨vscodeä¸‹çš„eideæ­å»ºå¼€å‘ç¯å¢ƒ

å‚æ–¹sdkåº“å·²æ”¹åŠ¨
è¯·ä½¿ç”¨ç”¨æœ¬ä»“åº“æä¾›çš„sdk ä½äºsys/kernelä¸‹

å¤§é‡ä½¿ç”¨iqmathåœ¨æ— æµ®ç‚¹å•å…ƒçš„æƒ…å†µä¸‹è¿›è¡Œé«˜é€Ÿæ•°å­¦è¿ç®— è¯·é€‰æ‹©16ä½IQæ•°ï¼ˆè°ƒæ•´å®å®šä¹‰GLOBAL_Qï¼‰å¦åˆ™å¯èƒ½ä¼šå‡ºç°æ„æƒ³ä¸åˆ°çš„é—®é¢˜

## ğŸŒ±å‚ä¸è´¡çŒ®

ç®—æ˜¯ç”¨æ¥ç»ƒä¹ gitçš„é¡¹ç›®, ç¬¬ä¸€æ¬¡ä½¿ç”¨gitä¸å¤ªç†Ÿæ‚‰ å­©å­è‡ªä¸ªå†™ç€ç©çš„

ç”±äºç›®å‰é¡¹ç›®æ¶æ„å°šä¸ç¨³å®š ä¸è¦è½»æ˜“forkï¼ï¼ï¼ï¼ï¼


## ğŸ”¨å¼€å‘ç¯å¢ƒ

#### GCC
ç”±äºæœ¬é¡¹ç›®åŸºäºRISCVç»“æ„çš„å¾®å¤„ç†å™¨ï¼ˆARMCC or ARMCLANGä¸æ”¯æŒï¼‰æ•…ä½¿ç”¨GCCä½œä¸ºç¼–è¯‘å·¥å…·
ä¸”æœ¬é¡¹ç›®ä½¿ç”¨åˆ°äº†CPP20çš„ç‰¹æ€§è¿›è¡Œå¼€å‘ æ•…GCCçš„ç‰ˆæœ¬ä¸ä½äº12
åŒæ—¶ç”±äºWCHä¸ºäº†æ”¯æŒå¿«é€Ÿä¸­æ–­ ä¸ºGCCæ·»åŠ äº†é­”æ”¹çš„ä¸­æ–­å…³é”®å­— æ•…åº”ä½¿ç”¨WCHå®šåˆ¶çš„GCC12

éœ€è¦å®‰è£…[MounRiver Studio](http://www.mounriver.com/)ä»¥è·å–æˆ‘ä»¬æ‰€éœ€è¦çš„å‚å®¶é­”æ”¹ç‰ˆriscv-none-elf-gcc(ä¹°æ¤Ÿè¿˜ç å±äºæ˜¯äº†)

#### VSCODE 
ä¸ºäº†æä¾›æ’ä»¶EIDEçš„å®¿ä¸»ä»¥åŠè·å¾—å®‡å®™ç¬¬ä¸€çš„ç¼–ç ä½“éªŒ(æœ¬äººè®¤ä¸ºæ˜¯çš„) æˆ‘ä»¬éœ€è¦ä¸‹è½½vscodeå¹¶å®‰è£…

#### EIDE

ä¸ºäº†æä¾›æ–¹ä¾¿å¿«æ·å¼€ç®±å³ç”¨çš„ç¯å¢ƒä½“éªŒ æœ¬é¡¹ç›®é€‰æ‹©vscodeçš„æ’ä»¶eideè¿›è¡Œå¼€å‘ å…·ä½“è¯·ç§»æ­¥
[eide](https://em-ide.com/zh-cn/docs/intro/)

#### OPENOCD

ä¸ºäº†æ”¯æŒWCH-LinkåŸºäºOPENOCDè¿›è¡Œäº†å®šåˆ¶åŒ–å¼€å‘æ•…éœ€è¦å®‰è£…WCHæä¾›çš„OpenOCD(åŒæ ·åœ¨MounRiver Studioçš„å®‰è£…ç›®å½•ä¸­å¯ä»¥æ‰¾åˆ°)

#### ç¼–è¯‘é€‰é¡¹
os/o3
cpp20 + 


## ğŸ´ç›®å½•

##### docu æ–‡æ¡£

##### algo æ•°æ®ç®—æ³•
- [x] random ä¼ªéšæœºæ•°å‘ç”Ÿå™¨
- [x] hash å‡½æ•°
##### dsp ä¿¡å·å¤„ç†

- [x] ç¼–è¯‘æœŸè¶…è¶Šå‡½æ•°è®¡ç®—

- [ ] æ§åˆ¶å™¨
    - [x] PID æ§åˆ¶å™¨
    - [ ] æ¨¡ç³ŠPIDæ§åˆ¶å™¨
    - [ ] LQR æ§åˆ¶å™¨
    - [ ] MPC æ§åˆ¶å™¨
- [ ] fft(æœªæµ‹è¯•)

- [x] æ»¤æ³¢å™¨
    - [x] å¡å°”æ›¼æ»¤æ³¢å™¨
    - [x] ä½é€šæ»¤æ³¢å™¨
    - [x] é«˜é€šæ»¤æ³¢å™¨
    - [x] æ–½å¯†ç‰¹è§¦å‘å™¨
    - [x] æŠ–åŠ¨æ»¤æ³¢å™¨
    - [x] æ¯›åˆºæ»¤æ³¢å™¨
- [x] cordic ä¸‰è§’è¿ç®—å•å…ƒ

- [x] è§‚æµ‹å™¨
    - [x] ä¸€æ¬¡è§‚æµ‹å™¨

- [ ] çº¿æ€§è¿ç»­æ—¶é—´ç³»ç»Ÿ
- [x] æŸ¥æ‰¾è¡¨
- [ ] æŒ¯è¡å™¨
- [x] pll é”ç›¸ç¯

##### types å„ç§ç±»å‹

- [x] basis ä¸‰ç»´æ—‹è½¬çŸ©é˜µ(godot)
- [x] buffer ç¼“å†²ç»“æ„
    - [x] ringbuffer ç¯å½¢ç¼“å†²
    - [ ] pingpongbuffer ä¹’ä¹“ç¼“å†²
    - [ ] stack å †æ ˆç¼“å†²

- [x] color RGBAé¢œè‰²è¡¨è¿°
- [x] complex å¤æ•°
- [x] image å›¾åƒç±»
    - [x] font å­—ä½“ç±»
    - [ ] cursor å…‰æ ‡ç±»
    - [x] packedImage å‹ç¼©äºŒå€¼åŒ–å›¾ç‰‡
    - [x] painter ç»˜å›¾ç®—æ³•é©±åŠ¨

- [x] IQ(IQMATH)
    - [x] æ”¯æŒå››åˆ™è¿ç®— å¤§å°æ¯”è¾ƒ ç±»å‹è½¬æ¢
    - [x] æ”¯æŒè¶…è¶Šå‡½æ•°
    - [ ] æ”¯æŒstd::è¶…è¶Šå‡½æ•°
    - [ ] ä½¿ç”¨æ¨¡æ¿é‡æ„

- [ ] matrix çŸ©é˜µç±»
- [ ] polar æåæ ‡ç±»
- [x] quat å››å…ƒæ•°ç±»(godot)
- [x] range åŒºé—´ç±»
- [x] rect2 çŸ©å½¢åŒºåŸŸç±»
- [x] string å­—ç¬¦ä¸²ç±»(arduino)
- [x] vector2 äºŒç»´å‘é‡ç±»(godot)
- [x] vector3 ä¸‰ç»´å‘é‡ç±»(godot)
- [x] rgb å„ç±»é¢œè‰²ç»“æ„ä½“
- [x] uint24_t 24ä½æ•°æ®

##### protocol é€šä¿¡åè®®

- [ ] `CANSF` è‡ªç ”è½»é‡CANé©±åŠ¨
- [ ] `CANOPEN` å¤§é‡è½åœ°é€šç”¨CANæ¡†æ¶

##### drivers è®¾å¤‡é©±åŠ¨

æ—¥åè°ˆ

##### scripts è„šæœ¬æ–‡ä»¶


##### concept å¤–è®¾çš„æŠ½è±¡åŸºç±»

##### sys ç³»ç»Ÿ
- [x] tasker éæŠ¢å å¼ä»»åŠ¡é©±åŠ¨å™¨

##### src ä¸»è¦æºä»£ç 
+ å®å®šä¹‰å¤´æ–‡ä»¶
+ example/testbench
+ mainæ–‡ä»¶
##### hal ç‰©ç†æŠ½è±¡å±‚


- [ ] IOStream(è¾“å…¥è¾“å‡ºæµ)
    - [ ] `printf` `cout`(å†…å»ºè¾“å‡ºæµæ“ä½œ) 
    - [x] `println` `print` `<<` (åŸºæœ¬è¾“å…¥æµæ“ä½œ)
    - [ ] `format` (å­—ç¬¦ä¸²æ ¼å¼åŒ–) 


- [x] GPIO(IOç›¸å…³ä»£ç )
    - [x] bitband(ä½å¸¦æ“ä½œ)
    - [x] Gpio(å•ä¸ªIO)
    - [x] Port(IOç«¯å£)
    - [x] VirtualPort(è™šæ‹ŸIOç«¯å£)(ç”¨äºå°†å¤šä¸ªç‰‡ä¸Šä¸ç‰‡å¤–ç«¯å£æŒ‰é¡ºåºç»‘å®šè‡³ä¸€ä¸ªIOç«¯å£ä¸Š)

- [x] UART(å·²éªŒè¯921600æ³¢ç‰¹ç‡çš„é•¿æ—¶é—´å‹åŠ›æµ‹è¯•)
    - [x] å¯¹åŸºæœ¬è¾“å…¥è¾“å‡ºæµçš„æ”¯æŒ
    - [x] ç¯å½¢ç¼“å†²åŒºæ”¯æŒ
    - [x] DMA/ä¸­æ–­æ”¯æŒ
    - [ ] LinBus/æ™ºèƒ½å¡

- [x] SPI(å·²éªŒè¯72Mhzçš„é•¿æ—¶é—´å‹åŠ›æµ‹è¯•)
    - [x] ä¸€èˆ¬æ•°æ®æ”¶å‘
    - [ ] DMAæ•°æ®æ”¶å‘
    - [x] è™šæ‹Ÿç‰‡é€‰é›†çº¿å™¨
    - [x] è½¯ä»¶SPI

- [x] I2C(ä»¥éªŒè¯3.4Mhzçš„è½¯ä»¶I2C)
    - [x] è½¯ä»¶I2C
    - [x] ç¡¬ä»¶I2C
    - [x] ä¸€èˆ¬æ•°æ®æ”¶å‘
    - [ ] DMAæ•°æ®æ”¶å‘
    - [ ] SMbus

- [ ] I2S(ä»¥éªŒè¯è½¯ä»¶I2Såªå‘)
    - [x] è½¯ä»¶I2Såªå‘
    - [x] TM8211
    - [ ] ç¡¬ä»¶I2S
    - [ ] I2Sè¯»å–

- [x] CAN(æœºå™¨äººå±€åŸŸç½‘æ€»çº¿)
    - [x] ä¿¡ç®±åŠFIFOé©±åŠ¨
    - [x] è¾“å…¥è¾“å‡ºç¯å½¢ç¼“å†²åŒº
    - [x] æ ‡å‡†IDä¸æ‹“å±•IDä¸‹Msgå‘é€æ¥æ”¶
    - [x] æ ‡å‡†IDä¸‹çš„è¿‡æ»¤å™¨

- [ ] Adc
    - [x] ä»»æ„é€šé“å•è·¯ä¿¡å·é‡‡é›†
    - [x] ä»»æ„é€šé“å¤šè·¯ä¿¡å·é‡‡é›†
    - [ ] DMAç»‘å®šAPI
    - [x] ç‰‡ä¸Šæ¸©åº¦/å‚è€ƒç”µå‹é‡‡é›†
    - [ ] è™šæ‹ŸADCChannelç±»

- [x] DVP
    - [x] MT9V034æ‘„åƒå¤´é©±åŠ¨
    - [ ] OV2640æ‘„åƒå¤´é©±åŠ¨

- [x] CRC
- [x] OPA
- [x] NVIC
- [x] EXTI

- [x] FLASH
    - [ ] æ™®é€šFLASHè¯»å†™(ä»¥å¼ƒç”¨)
    - [x] å¿«é€ŸFLASHè¯»å†™

- [x] TIM(å®šæ—¶å™¨ç›¸å…³ä»£ç )
    - [x] ä¸­æ–­ä¸å›è°ƒå‡½æ•°ç»‘å®š
    - [x] ç¼–ç å™¨æ¨¡å¼
    - [ ] PWMModule PWMè¾“å‡ºé›†çº¿å™¨

    - [x] PWMChannel PWMè¾“å‡ºæ¦‚å¿µ
        - [x] AW9523Pwm åŸºäºAW9523çš„pwm
        - [x] GPIOPwm ä½¿ç”¨GPIOé…åˆå®šæ—¶è§¦å‘æ¨¡æ‹Ÿpwm

        - [ ] TimerOC(å®šæ—¶å™¨è¾“å‡º)
            - [x] TimerOC
            - [ ] Hrpwm(é«˜ç²¾åº¦PWM)

    - [ ] CaptureChannel è¾“å…¥æ•è·æ¦‚å¿µ 
        - [x] ExtiCapture åŸºäºEXTIçš„è¾“å…¥æ•è·
        - [ ] TimerIC(å®šæ—¶å™¨è¾“å…¥æ•è·)

- [ ] TCP/UDP
- [ ] USB
- [ ] BLE


##### robots æœºå™¨äººå­¦ç›¸å…³ä»£ç 

- [ ] æ­¥è¿›ç”µæœºFOCç®—æ³•

- [x] `buck.hpp` BUCKé©±åŠ¨
- [x] `pmdc.hpp` ç›´æµæœ‰åˆ·ç”µæœºé©±åŠ¨ç®—æ³•
- [ ] `spread_cycle.hpp` å¯¹SpeadCycleæ–©æ³¢é©±åŠ¨çš„ä½åŠ£æ¨¡ä»¿

